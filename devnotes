source /Users/philgarber/.rvm/scripts/rvm


Building 8rate from a rails 3.1, mongoid, devise, bootstrap barebones app

Start with code/8ratev1_pre_theme

compare to John's sample_user_auth:

In 8ratev1_pre_theme, add a bunch of html from divshot to application.html.erb

I'm calling it BumptUp now.  I have spider blocker on.  

BU logo is http://i.imgur.com/0Pua12E.png

my git is pretty messed up in this project.  I dont think I had github going on 8ratev1_pre_theme.  then I branched to BUv1.  

So, SWITCH TO BUv1 repo and BUv1 folder on my local drive (code/BUv1).  Branch is main

3/19/14 - come back to this one after a couple months to get Devise and Mongo

To start this project, 
1 tab: BUv1 $ rails s
2nd tab: BUv1 $ mongod
go to localhost:3000

It looks like I can create create a user, but there are no pages other than the landing page

What I need to do:
- put in one view at a time, keep everything working
- put in models projects first?


$ rails generate controller Attributes  # didn't do no-test-framework
$ rails generate model Attribute attribute_name:string category:string identifier:integer
# assuming I don't need to rake db:migrate

$ rails g controller Feedbacks
    conflict  app/controllers/feedbacks_controller.rb
Overwrite /Users/philgarber/code/BUv1/app/controllers/feedbacks_controller.rb? (enter "h" for help) [Ynaqdh] n
$ rails g model Feedback from_id:integer to_id:integer attribute_identifier rating_given:float accounted_for:datetime 

to view my db, open MongoHub.  go to the right table on the left, then hit Query.  Then Run in the window that pops up
http://stackoverflow.com/questions/7000605/how-to-implement-has-many-through-relationships-with-mongoid-and-mongodb

$ rails g controller Companies
$ rails g model Company domain:string name:string
$ rails g controller Projects
    conflict  app/controllers/projects_controller.rb
Overwrite /Users/philgarber/code/BUv1/app/controllers/projects_controller.rb? (enter "h" for help) [Ynaqdh] n
$ rails g model Project name:string company_id:integer
$ rails g controller ProjectFeedbacks  # forgot to add columns
$ rails g controller ProjectRatings
$ rails g model ProjectRating project_id:integer project_attribute_identifier:integer current_rating:float num_fb_received:float 
$ rails g controller ProjectAttributes
$ rails g model ProjectAttribute name:string

change a bunch of things to belongs_to or has_many in the models files

change again...


  # user.company = co   # this line isn't getting it done #####################
  co.users << user  # THIS WORKS AND PREVIOUS LINE DOESNT!!!
  A user belongs to a company, so I guess you have to assign as co.users << user

  cant get ProjectFeedback to work.  Try generating again, slight different name:
  $ rails g controller Pfeedbacks
  $ rails g model Pfeedback attrib:string from_id:string rating_given:float accounted_for:datetime  # needed to be DateTime?  this gave accounted_for:time

  it works with pfeedback, but not project_feedback model.  No idea why.  Oh well, move on

  TODO: assign ( & create if needed) companies when users sign up

  framework_and_overrides.css - importing bootstrap here was killing my Mist navbar styling, and some other styling

the view for signin is not in my files, so: $ rails generate devise:views
now, the RegistrationsController whose create method gets called when I create new user is also not in the files.   

After trying to get create colleagues going (I got as far as rendering the page and it seems to work, yet no new user is created.  Then I added a self_create to the model and nothing works anymore).  I stashed this:
$ git stash
Saved working directory and index state WIP on build1: 13dd6e7 create projects works
HEAD is now at 13dd6e7 create projects works


Skip to entering sentences:
- to get Angular working, in application.html.erb, put <html ng-app> and <script> for the angular CDN

$ rails generate model Pattribute name:string category:string identifier:integer category:string
$ rails generate controller Pattributes

4/23/14  It seems like I've got no .gitignore  
There is .git/info/exclude, but nothing's listed.  add application.example.yml.  Anything else?  


Merge back to master, got merge conflicts.  To solve it, do this (in addition to manually fixing any actual conflicts)
$ git mergetool  // can do this to pop up a window & see differences
$ git checkout --ours log/development.log   // --theirs is the other way
$ git add log/development.log
$ git commit -m "trying to solve master vs build1 merge issues"
$ git merge build1
Already up-to-date.

MAIL #######################
  first, I have to get application.yml and other things out of my git.  Put a .gitignore in project root folder.
  $ git rm --cached config/application.example.yml  // not sure I need --cached
  then, git add, git commit, git push
  $ rails g mailer user_mailer project_creation
        create  app/mailers/user_mailer.rb
        invoke  erb
        create    app/views/user_mailer
        create    app/views/user_mailer/project_creation.text.erb
        invoke  rspec
        create    spec/mailers/user_mailer_spec.rb
        create    spec/fixtures/user_mailer/project_creation

    also make views/user_mailer/project_creation.html.erb
    each email needs a method in user_mailer.rb
    call the method in projects_controller create action with UserMailer.project_creation(@user, @project).deliver

Trying to get Google Apps going so I can use phil@prietary.com email
$ heroku domains:add www.prietary.com
Adding www.prietary.com to polar-badlands-2176... done
$ heroku domains:add prietary.com
Adding prietary.com to polar-badlands-2176... done

Follow instuctions on Heroku site for using your own url.  I can't figure out how to create a CNAME record in 1and1 (never use this site again).  So, I created a DNSimple account and moved the nameservers to dnsimple's.

Actually, now that I have DNSimple, I should be able to verify my domain just by creating the CNAME record, rather than pointing a heroku app there and putting in the meta tag. 
So, I got prietary verified @ Google Apps by adding a TXT record in DNsimple.  Have phil@prietary.com and contact@prietary.com
ToDo: put a decent site on Heroku, and, using instructions on heroku, set Prietary.com to point there.  Screw it - just go live.  Maybe say its in Alpha  

########## List of emails I wan to send #######
1) sign up - before signing in, user must click on link in email. So, before this is done, redirect to "need to verify include resend link and suggestion to check spam folder" page rather than homepage
2) account verified email (what you can do, how to create colleagues)
3) forgot password (link on login page and sign up page)
4) create project (done)
5) you receive feedback (once per day, max)
6) you receive a response to a feedback (1x/day max)
7) One of your projects receives feedback (1x/day max with link to stop getting notified)
8) 


Working on getting alerts working again.  
In application.html.erb, need all of this:
        <% flash.each do |key, value| %>
          <%= content_tag(:div, value, class: "alert alert-#{key}") %>
        <% end %>
        <%= render 'layouts/messages' %>

messages are in config/locales/devise.en.yml
I am rendering two messages, the first of which is behind the navbar.  I can''t figure out how to get just one to show up, yet have it not covered up.  messes up the spacing as is.  

For date, add this to all my models:
field :created, type: DateTime, default: -> { Time.now }

########### IDEAS ##################

class Idea < ActiveRecord::Base
  field :body, type: Text
  field :created, type: DateTime, default: -> { Time.now }
  belongs_to :user
  belongs_to :company
  belongs_to :thread, :class_name => 'Idea'  # Reference to parent message
  has_many :replies,  :class_name => 'Idea', :foreign_key => 'thread_id' (?)

  # ? # named_scope :in_reply_to, lambda { |idea| :conditions => {:thread => idea}, :order => 'created_at' }
  has_many :votes
end

class User < ActiveRecord::Base
  has_many :ideas
  has_many :votes
end

class Company
  has_many :ideas
end

class Vote < ActiveRecord::Base
  field :value, type: Integer
  field :created, type: DateTime, default: -> { Time.now }
  belongs_to :idea
  belongs_to :user

If you need to capture the message threads, any Message that's a reply can store a reference to the initial message starting the Conversation (aka Thread). For example:
I need more advanced than this since it's a message board, not just a text message stream':

first_msg   = Idea.new(user => current_user, :body => 'Hello!')
sally_reply = first_msg.replies.build(:to_user => bob, :from_user => sally, :body => 'hi back')
bob_reply   = first_msg.replies.build(:to_user => sally, :from_user => bob, :body => 'later')

$ rails g controller Ideas
$ rails g model Idea body:text created:datetime # becomes time
$ rails g controller Votes
$ rails g model Vote value:integer created:datetime  # becomes time

Working on ideas
in development.rb, set   config.action_mailer.perform_deliveries = false #for now
This wasn't stopping emails from sending. so I did that in production.rb also ??

working in branch 'may'

got the form on the same line by doing <%= form_for idea.votes.build, :html => { :style => 'display:inline;' } do |f| %>
to not redirect, do "return false;" in the javascript !!


################# JOBS #################################
$ rails g controller Jobs
$ rails g model Job created:datetime

Ideas: if you specify a wrong thread during a idea creation, it won't show up on idea page.

Working on alerts layout spacing again.
custom1.css, in wrapper:  padding-top: 0px; was 91px, which caused extra space below the alert.  
